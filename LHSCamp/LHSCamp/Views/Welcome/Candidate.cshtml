@{
    ViewBag.Title = "Candidate Settings";
}
@section Styles {
    @Styles.Render("~/Content/Styles/Bundles/Home/welcome-candidate.less")
    <style type="text/css">
        .picker-page {
            display: none;
            width: 90%;
            margin-left: 5%;
        }

        .tabs-list li {
            width: 20%;
        }
    </style>
}
<div style="position:relative;width:80%;left:10%;">
    <h1>Welcome to LHS Campaign!</h1>
    @if (ViewBag.Confirmed)
    {
        <span>
            We'll run through a few quick questions to get your candidate account set up.
            Once you're verified (which may take up to 24 hours),
            you'll be allowed to upload your profile image and be featured on LHS Campaign.
        </span>
    }
    <ul class="tabs-list">
        <li class="tab sel-tab" data-picker-page="email"><div>EMAIL</div></li>
        <li class="tab" data-picker-page="position"><div>POSITION</div></li>
        <li class="tab" data-picker-page="campaign"><div>CAMPAIGN</div></li>
        <li class="tab" data-picker-page="social"><div>SOCIAL</div></li>
        <li class="tab" data-picker-page="picture"><div>PICTURE</div></li>
    </ul>
    <div class="tab-box">
        <div id="picker-page-email" class="picker-page sel-page" style="display:block;">
            Candidates must have a verified email before getting started.
            <br />
            <br />
            @if (string.IsNullOrWhiteSpace(ViewBag.Email))
            {
                @:Please enter an email below:
            }
            else
            {
                @:If you want to make changes to your email, make them below:
            }
            <br /><br />
            <input type="email" id="email-input" class="default-input standard-input" value="@(ViewBag.Email)" style="width:400px;" />
            <br />
            <button id="update-email" class="default-btn standard-btn">Save</button>
            <br /><br />
            We'll contact you within 24 hours to confirm your email and give you a rundown of the final step before you're listed as a candidate.
        </div>
        <div id="picker-page-position" class="picker-page">
            What position are you running for?
            <br />
            <div style="position:relative;width:333px;" class="half-horiz">
                <select id="position" class="default-input standard-input" style="margin-top:20px;width:333px;height:50px;padding-right:-50px;">
                    @foreach(var pos in new string[] { "Secretary", "Treasurer", "President", "Vice President" }) {
                        if(pos == ViewBag.Position) {
                        <option selected>@pos</option>
                        }
                        else {
                        <option>@pos</option>
                        }
                    }
                </select>
                <div id="arrow-hider" style="position:absolute;width:30px;height:46px;right:2px;top:22px;background-color:#44A0C8;border-radius:2px;"></div>
            </div>
            <button class="default-btn standard-btn" id="save-position">Confirm Position</button>
        </div>
        <div id="picker-page-campaign" class="picker-page">
            Why should voters vote for you? Please enter a paragraph or two below explaining why you're the best candidate.
            <br /><br />
            <!-- Thanks! http://stackoverflow.com/questions/4220381/replace-line-break-characters-with-br-in-asp-net-mvc-razor-view -->
            <textarea id="campaign-reasons" class="small-font default-input standard-input" style="text-align:left;width:90%;height:300px;white-space:pre-wrap;">@ViewBag.Reasons</textarea>
            <br />
            <button class="default-btn standard-btn" id="save-reasons">Save Reasons</button>
        </div>
        <div id="picker-page-social" class="picker-page">
            Facebook Link:<br /><br />
            <input type="text" id="campaign-social" class="default-input standard-input" style="width:400px;" placeholder="http://facebook.com/example..." />
            <br />
            <button class="default-btn standard-btn" id="save-social">Save</button>
            <br /><br />
            If you don't have a Facebook page or event, just click on 'Save' to continue.
        </div>
        <div id="picker-page-picture" class="picker-page">
            @if (ViewBag.Confirmed)
            {
                @:Please be aware that your profile picture must be less than 2MB in size.
                <br /><br />
                @:If your picture is larger than that (or if you have any other problems), please don't hesitate to contact vip@lhscampaign.com and we'll make it work.
                <form action="~/Welcome/UploadProfile" method="POST" enctype="multipart/form-data">
                    <input type="file" name="file" />
                    <br />
                    <input type="submit" value="Upload" class="default-btn standard-btn" />
                </form>
            }
            else
            {
                @:Your account must be confirmed before you can upload a photo and be listed as an official candidate.
                <br /><br />
                @:You should get an email from someone on the LHS Campaign team within 24 hours to confirm your account.
                <br /><br />
                @:If you have any problems, feel free to email vip@lhscampaign.com for personal help.
            }
        </div>
    </div>
</div>
@section Scripts {
    <script type="text/javascript">
        $(".tab").click(function () {
            $(".tab").removeClass("sel-tab");
            $(this).addClass("sel-tab");
            var page = $(this).attr("data-picker-page");
            $(".sel-page").fadeOut();
            $("#picker-page-" + page).fadeIn();
            $("#picker-page-" + page).addClass("sel-page");
        });

        $("#update-email").click(function () {
            var email = $("#email-input").val();
            $.post("/API/Account/SetEmail", {
                "email": email
            }, function (data) {
                if (data == "set") {
                    $("[data-picker-page=position]").click();
                }
            });
        });

        $("#save-position").click(function () {
            var position = $("#position").val();
            $.post("/API/Account/SetPosition", {
                "position": position
            }, function (data) {
                if (data == "set") {
                    $("[data-picker-page=campaign]").click();
                }
            });
        });

        $("#save-reasons").click(function () {
            var reasons = $("#campaign-reasons").val();
            $.post("/API/Account/SetReasons", {
                "reasons": reasons
            }, function (data) {
                if (data == "set") {
                    $("[data-picker-page=social]").click();
                }
            });
        });

        $("#save-social").click(function () {
            var fb = $("#campaign-social").val().trim().toLowerCase();
            if (fb == $("#campaign-social").attr("placeholder")) {
                fb = '';
            }
            if (fb != '' && fb.indexOf('http') != 0) {
                fb = 'https://' + fb;
            }
            $("#campaign-social").val(fb);
            $.post("/API/Account/SetSocial", {
                "facebook": fb
            }, function (data) {
                if (data == "set") {
                    $("[data-picker-page=picture]").click();
                }
            });
        });
    </script>
}